name: PR checks
on:
  pull_request:

jobs:
  generate-sdk:
    name: Generate SDK
    runs-on: ubuntu-latest
    steps:
      - name: checkout the code of the application
        uses: actions/checkout@v1
        with:
          persist-credentials: false

      - name: install node ${{ matrix.node-version }} on the container
        uses: actions/setup-node@v1
        with:
          node-version: 18.4.0

      - name: install npm dependencies
        run: npm ci

      - name: generate metadata
        run: npm run generate-metadata

      - name: generate sdk
        run: npm run generate-sdk

      - name: lint
        run: npm run lint

      - name: tests
        run: npm run test

      - name: build the application
        run: npm run build

  notification:
    name: Notify
    runs-on: ubuntu-latest
    needs: [generate-sdk]
    if: always()
    steps:
      - name: Send mail
        uses: dawidd6/action-send-mail@v3
        with:
          server_address: smtp.gmail.com
          server_port: 465
          secure: true
          username: jsoto@gladia.io
          password: ${{secrets.MAIL_PASSWORD}}
          subject: ${{github.triggering_actor}} has done shit on ${{github.repository}}, ${{github.run_id}}
          to: github-notifications@gladia.io,jsoto@gladia.io
          from: Big Brother
          body: watch here https://github.com/${{github.repository}}/actions/runs/${{github.run_id}}
